document.addEventListener('DOMContentLoaded', function() {
    const quizContainer = document.getElementById('computer-quiz');
    const resultContainer = document.getElementById('computer-quiz-results');
    const certificateContainer = document.getElementById('computer-quiz-certificate');
    const submitButton = document.getElementById('submit-computer-quiz');
    const computerQuestions = [
        {
            question: "ูุง ูู ุงูุญุงุณูุจุ",
            answers: [
                "ุฌูุงุฒ ุฅููุชุฑููู ููุนุงูุฌุฉ ุงูุจูุงูุงุช",
                "ุขูุฉ ุชุตููุฑ",
                "ูุงุชู ุฐูู",
                "ุฌูุงุฒ ุงุณุชูุจุงู ุชููุฒูููู"
            ],
            correctAnswer: 0
        },
        {
            question: "ูุง ูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ (CPU)ุ",
            answers: [
                "ุฌูุงุฒ ุชุฎุฒูู",
                "ุนูู ุงูุญุงุณูุจ ุงูุฑุฆูุณู",
                "ุดุงุดุฉ ุงูุนุฑุถ",
                "ููุญุฉ ุงูููุงุชูุญ"
            ],
            correctAnswer: 1
        },
        {
            question: "ูุง ูู ุฃููุงุน ุงูุฐุงูุฑุฉ ูู ุงูุญุงุณูุจุ",
            answers: [
                "RAM ู ROM",
                "ูุงููุฑุง ููููุฑูููู",
                "ุณูุงุนุงุช ููุงูุณ",
                "ุดุงุดุฉ ูุทุงุจุนุฉ"
            ],
            correctAnswer: 0
        },
        {
            question: "ูุง ูู ุฃูููุฉ ูุธุงู ุงูุชุดุบููุ",
            answers: [
                "ูุง ุฃูููุฉ ูู",
                "ุฅุฏุงุฑุฉ ููุงุฑุฏ ุงูุญุงุณูุจ ูุชุดุบูู ุงูุจุฑุงูุฌ",
                "ุฒูุงุฏุฉ ุชูููุฉ ุงูุญุงุณูุจ",
                "ุชุนุทูู ุนูู ุงูุญุงุณูุจ"
            ],
            correctAnswer: 1
        },
        {
            question: "ูุง ูู ุงููุฑู ุจูู ุงูุจุฑุงูุฌ ูุงูุฃุฌูุฒุฉุ",
            answers: [
                "ูุง ููุฌุฏ ูุฑู",
                "ุงูุจุฑุงูุฌ ูู ุงูุชุนูููุงุช ูุงูุฃุฌูุฒุฉ ุงูููููุงุช ุงููุงุฏูุฉ",
                "ุงูุจุฑุงูุฌ ุฃูู ูู ุงูุฃุฌูุฒุฉ",
                "ุงูุฃุฌูุฒุฉ ุฃูู ูู ุงูุจุฑุงูุฌ"
            ],
            correctAnswer: 1
        },
        {
            question: "ูุง ูู ุดุจูุงุช ุงูุญุงุณูุจุ",
            answers: [
                "ูุง ุฏูุฑ ููุง",
                "ุงุชุตุงู ุงูุญูุงุณูุจ ูุชุจุงุฏู ุงููุนูููุงุช",
                "ุฌูุงุฒ ูุงุญุฏ ููุท",
                "ุจุฑูุงูุฌ ูุงุญุฏ"
            ],
            correctAnswer: 1
        },
        {
            question: "ูุง ูู ุฃูููุฉ ุงูุฅูุชุฑูุชุ",
            answers: [
                "ูุง ุฃูููุฉ ูู",
                "ุงูุชูุงุตู ูุชุจุงุฏู ุงููุนูููุงุช ุนุงููููุง",
                "ุฒูุงุฏุฉ ุชูููุฉ ุงูุงุชุตุงู",
                "ุฅุจุทุงุก ุณุฑุนุฉ ุงูุญุงุณูุจ"
            ],
            correctAnswer: 1
        },
        {
            question: "ูุง ูู ูุบุงุช ุงูุจุฑูุฌุฉุ",
            answers: [
                "ูุบุงุช ุงูุชุฎุงุทุจ",
                "ูุบุงุช ููุชูุงุตู ูุน ุงูุญุงุณูุจ",
                "ูุบุงุช ุฌุบุฑุงููุฉ",
                "ูุบุงุช ุงูุทุจุฎ"
            ],
            correctAnswer: 1
        },
        {
            question: "ูุง ูู ุฏูุฑ ููุงุนุฏ ุงูุจูุงูุงุชุ",
            answers: [
                "ูุง ุฏูุฑ ููุง",
                "ุชุฎุฒูู ูุฅุฏุงุฑุฉ ุงููุนูููุงุช ุจููุงุกุฉ",
                "ุฒูุงุฏุฉ ุญุฌู ุงููููุงุช",
                "ุฅุจุทุงุก ุนูู ุงูุญุงุณูุจ"
            ],
            correctAnswer: 1
        },
        {
            question: "ููู ูุณุงูู ุงูุญุงุณูุจ ูู ุญู ุงููุดููุงุชุ",
            answers: [
                "ูุง ูุณุงูู",
                "ูุนุงูุฌุฉ ุงูุจูุงูุงุช ูุชุญููููุง ุจุณุฑุนุฉ",
                "ุฒูุงุฏุฉ ุงูุชุนููุฏ",
                "ุงุณุชููุงู ุงูุทุงูุฉ"
            ],
            correctAnswer: 1
        }
    ];

    function buildQuiz() {
        const output = [];

        computerQuestions.forEach((currentQuestion, questionNumber) => {
            const answers = [];

            for (let i = 0; i < currentQuestion.answers.length; i++) {
                answers.push(
                    `<label class="quiz-option">
                        <input type="radio" name="question${questionNumber}" value="${i}">
                        ${currentQuestion.answers[i]}
                    </label>`
                );
            }

            output.push(
                `<div class="quiz-question">
                    <p>${currentQuestion.question}</p>
                    <div class="quiz-options">${answers.join('')}</div>
                </div>`
            );
        });

        quizContainer.innerHTML = output.join('');
    }

    // ุงุณุชูุงุน ููุชุบูุฑุงุช ูู ุงูุฑุงุจุท
    window.addEventListener('hashchange', function() {
        if (window.location.hash === '#computer-quiz') {
            // ุฅุธูุงุฑ ูุณู ุงูุงุฎุชุจุงุฑ
            quizContainer.style.display = 'block';
            
            // ุฅุฎูุงุก ุงูุฃูุณุงู ุงูุฃุฎุฑู
            const otherSections = document.querySelectorAll('section');
            otherSections.forEach(section => {
                if (section.id !== 'computer-quiz') {
                    section.style.display = 'none';
                }
            });
        } else {
            // ุฅุฎูุงุก ูุณู ุงูุงุฎุชุจุงุฑ
            quizContainer.style.display = 'none';
        }
    });

    function showResults() {
        const answerContainers = quizContainer.querySelectorAll('.quiz-options');
        let numCorrect = 0;

        computerQuestions.forEach((currentQuestion, questionNumber) => {
            const answerContainer = answerContainers[questionNumber];
            const selector = `input[name=question${questionNumber}]:checked`;
            const userAnswer = (answerContainer.querySelector(selector) || {}).value;

            if (userAnswer == currentQuestion.correctAnswer) {
                numCorrect++;
                answerContainers[questionNumber].style.color = 'green';
            } else {
                answerContainers[questionNumber].style.color = 'red';
            }
        });

        // Calculate percentage
        const percentage = Math.round((numCorrect / computerQuestions.length) * 100);
        const passed = percentage >= 60;

        // Store score in localStorage
        localStorage.setItem('computerQuizScore', percentage.toString());

        showCertificate(percentage);
    }

    function showCertificate(percentage) {
        // ุฅุฎูุงุก ุนูุงุตุฑ ุงูุงุฎุชุจุงุฑ
        const quizContainer = document.getElementById('computer-quiz');
        const submitButton = document.getElementById('submit-computer-quiz');
        quizContainer.style.display = 'none';
        submitButton.style.display = 'none';

        let recommendation = '';
        let certificateColor = '';
        let certificateIcon = '';

        if (percentage >= 90) {
            recommendation = "ูุณุงุฑ ุนููู ุงูุญุงุณูุจ ุงููุชูุฏู";
            certificateColor = "gold";
            certificateIcon = "๐ป";
        } else if (percentage >= 70) {
            recommendation = "ูุณุงุฑ ุชูููุฉ ุงููุนูููุงุช";
            certificateColor = "silver";
            certificateIcon = "๐ฅ๏ธ";
        } else {
            recommendation = "ูุณุงุฑ ุงูุชุนูู ุงูุฃุณุงุณู";
            certificateColor = "bronze";
            certificateIcon = "๐";
        }

        // ุฅุถุงูุฉ ูุคุซุฑุงุช ุงุญุชูุงููุฉ
        const confettiContainer = document.createElement('div');
        confettiContainer.classList.add('confetti-container');
        document.body.appendChild(confettiContainer);

        // ุฅูุดุงุก ุฃุดูุงู ุงููููููุชู
        for (let i = 0; i < 100; i++) {
            const confetti = document.createElement('div');
            confetti.classList.add('confetti');
            confetti.style.left = `${Math.random() * 100}%`;
            confetti.style.animationDelay = `${Math.random() * 3}s`;
            confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
            confettiContainer.appendChild(confetti);
        }

        // ุชุดุบูู ุตูุช ุงุญุชูุงูู
        const celebrationSound = new Audio('sounds/celebration.mp3');
        celebrationSound.play();

        certificateContainer.innerHTML = `
            <div class="certificate-container">
                <div class="certificate ${certificateColor}">
                    <div class="certificate-header">
                        <img src="https://i.ibb.co/hLDFpQN/DALL-E-2025-01-12-04-45-22-A-friendly-and-playful-logo-for-a-kids-school-named-Ai-Ki-DS-SCHOOL-featu.png" alt="AI Kids School Logo" class="certificate-logo">
                        <h1>ุดูุงุฏุฉ ุฅุชูุงู</h1>
                        <h2>ุงุฎุชุจุงุฑ ุงูุญุงุณูุจ</h2>
                    </div>
                    <div class="certificate-body">
                        <div class="certificate-icon">${certificateIcon}</div>
                        <p>ุงููุชูุฌุฉ: ${percentage}%</p>
                        <h3>ุงูุชูุตูุฉ: ${recommendation}</h3>
                    </div>
                    <div class="certificate-footer">
                        <p>ุชูุงูููุง ุนูู ุฅููุงู ุงูุงุฎุชุจุงุฑ!</p>
                        <div class="certificate-seal">ูุนุชูุฏ</div>
                    </div>
                </div>
                <div class="next-steps">
                    <h3>ุงูุฎุทูุงุช ุงูุชุงููุฉ</h3>
                    <ul>
                        <li>ุงุณุชูุดู ุฏูุฑุงุช ุนููู ุงูุญุงุณูุจ</li>
                        <li>ุชุงุจุน ุงูุชุนูู ูู ูุณุงุฑ ${recommendation}</li>
                        <li>ุดุงุฑู ูู ูุฑุด ุนูู ุชูุงุนููุฉ</li>
                    </ul>
                    <a href="#" class="btn btn-primary">ุงุณุชูุดู ุงููุณุงุฑุงุช</a>
                </div>
            </div>
        `;

        // ุฅุถุงูุฉ CSS ููุชุฃุซูุฑุงุช
        const style = document.createElement('style');
        style.textContent = `
            .confetti-container {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: 10000;
            }
            .confetti {
                position: absolute;
                width: 10px;
                height: 10px;
                opacity: 0.7;
                transform: rotate(0deg);
                animation: fall 3s linear infinite;
            }
            @keyframes fall {
                0% {
                    top: -10px;
                    transform: rotate(0deg);
                }
                100% {
                    top: 100%;
                    transform: rotate(360deg);
                }
            }
        `;
        document.head.appendChild(style);

        // ุฅุฒุงูุฉ ุงููููููุชู ุจุนุฏ 5 ุซูุงูู
        setTimeout(() => {
            confettiContainer.remove();
        }, 5000);

        // ุฅุธูุงุฑ ุงูุดูุงุฏุฉ
        certificateContainer.style.display = 'block';

        // ุฅุถุงูุฉ ุฒุฑ ููุงูุชูุงู ูููุฑุญูุฉ ุงูุชุงููุฉ
        if (percentage >= 60) {
            resultContainer.innerHTML += `
                <div class="next-step text-center mt-4">
                    <p>ุฃุญุณูุช! ููููู ุงูุขู ุงููุชุงุจุนุฉ ุฅูู ุงููุณุงุฑ ุงูุชุงูู</p>
                    <a href="index.html#personalized-path" class="btn btn-primary">ุงุฎุชุฑ ูุณุงุฑู ุงููููู</a>
                </div>
            `;
        }

        // If passed, enable career path quiz
        if (percentage >= 60) {
            const careerPathQuizSection = document.getElementById('personalized-path');
            if (careerPathQuizSection) {
                careerPathQuizSection.classList.remove('disabled');
                careerPathQuizSection.querySelector('.path-card-header').innerHTML += 
                    '<span class="badge bg-success">ูุคูู ููุงุฎุชุจุงุฑ</span>';
            }
        }
    }

    // Start the quiz
    buildQuiz();

    // Submit button handler
    submitButton.addEventListener('click', showResults);

    // ุงูุชุญูู ูู ุงูุฑุงุจุท ุนูุฏ ุงูุชุญููู
    if (window.location.hash === '#computer-quiz') {
        quizContainer.style.display = 'block';
    }
});
